# Reglas de Acciones Automáticas del Sistema

Este documento resume las acciones automáticas que el sistema realiza en respuesta a ciertos eventos, como el inicio de sesión, el inicio de un turno o el paso del tiempo.

## 1. Acciones al Iniciar Sesión

### 1.1. Automatización para el Rol "Reloj Control"
- **Disparador:** Un usuario con la posición "Reloj Control" inicia sesión.
- **Condiciones:**
  - No se han ejecutado ya las acciones automáticas en la sesión actual.
  - El usuario está programado para trabajar en el día y hora actual.
- **Acciones Combinadas:**
  1.  **Marcaje de Entrada Automático:**
      - Si el usuario no tiene una entrada abierta y la hora es posterior al inicio de su turno, el sistema registra su "entrada" automáticamente.
  2.  **Inicio de Turno Automático:**
      - Si no hay un turno activo en el Libro de Novedades y la hora de inicio de sesión es cercana a su turno, el sistema inicia un nuevo turno a su nombre, incluyendo la novedad "Inicio de Turno".

## 2. Acciones en el Libro de Novedades

### 2.1. Marcaje de Entrada Automático al Iniciar un Turno Manualmente
- **Disparador:** Un usuario presiona el botón "Iniciar Turno" en el Libro de Novedades.
- **Condiciones:**
  - El usuario tiene un perfil de empleado vinculado.
  - El usuario está programado para trabajar en el día actual.
  - La hora actual está dentro del rango de 15 minutos antes del inicio de su turno y la hora de finalización.
  - El usuario no tiene un registro de "entrada" ya abierto.
- **Acción:** El sistema registra automáticamente la "entrada" del usuario antes de crear el nuevo reporte de turno.

### 2.2. Novedades Automáticas de Inicio y Cierre de Turno
- **Disparador:** Se inicia o se cierra un turno.
- **Acción al Iniciar:** Se agrega automáticamente la primera novedad al reporte: "Inicio de Turno, con Novedades Mencionadas".
- **Acción al Cerrar:** Se agrega automáticamente la última novedad al reporte antes de cerrarlo: "Cierre de Turno, con Novedades Mencionadas".

### 2.3. Cierre de Sesión Automático tras Cerrar un Turno
- **Disparador:** Un usuario cierra exitosamente el turno activo.
- **Acción:** Se muestra un modal con una cuenta regresiva de 5 segundos. Al finalizar, la sesión del usuario se cierra automáticamente para fomentar el relevo de turno.

## 3. Acciones en el Control de Horario y Dashboard

### 3.1. Cierre Automático de Turno al Marcar Salida como Responsable
- **Disparador:** Un usuario que es el responsable del turno activo en el Libro de Novedades marca su "salida".
- **Acción:** El sistema muestra un modal de confirmación. Si el usuario acepta, se registra su salida y se **inicia automáticamente el proceso de cierre de turno** en el Libro de Novedades (se agrega la anotación final y comienza la cuenta regresiva para el cierre de sesión).

### 3.2. Novedades Automáticas por Atraso o Ausencia (Dashboard)
- **Disparador:** El Dashboard está activo y detecta que un empleado programado no ha marcado su entrada.
- **Condiciones:**
  - Hay un turno activo en el Libro de Novedades.
  - El empleado tiene más de 15 minutos de atraso (se registra una vez por sesión).
  - El empleado tiene más de 60 minutos de atraso (se registra una vez por sesión como ausencia).
- **Acción:** El sistema agrega automáticamente una novedad en el turno activo indicando el "atraso" o la "ausencia" del empleado.
